# 拓扑排序

先讲个故事：

> 某年，一个叫 zb 的究极枪男想参加 See Ass Go 的全球线上赛。
> 想要报名这场比赛必须要有优先账户，可他发现 Valve 社脑子一抽改版了，现在只有线上赛的冠军才能获得优先账户，小惜 zb 并没有优先账户。
> 以 zb 的实力拿个冠军当然很简单，他随随便便就能薄纱其他人。
> 但 zb 不可能通过拿冠军的方式获得优先账户，因为他没法报名（大悲）。

~~其实是 zb 的钱全拿去买黄油了，没钱买优先账户了。~~

拓扑排序是一种用来对有向无环图上的所有结点进行排序的算法。

![](https://gitee.com/yukari1227/noip-review-materials/raw/master/%E9%99%84%E4%BB%B6/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F.png)

如对上图进行拓扑排序，则结果为 $1 \Rightarrow  3 \Rightarrow  4 \Rightarrow  5 \Rightarrow  2$ 。

## 算法介绍

为了更好的介绍拓扑排序，先引入几个**有向图**中的概念：

- **度**：一个点的度数指与该结点关联的边的数量。
- **入度**：一个点的入度指以该结点为终点的边的数量。
- **出度**：一个点的出度指以该结点为起点的边的数量。
- **出边**：一个点的出边指由该结点指向其他结点的边。

拓扑排序的核心思想是，删除**入度**为 $0$ 的结点，然后更新其他结点的入度。删除顺序即为拓扑排序顺序。

在上面的故事中，zb 不能通过先拿冠军再报名，因为这两件事情互为前提。类似的，环是没有拓扑排序的，因为它们互相为对方提供了**入度**，没有点入度为 $0$。

### 初始化

- 在建图时，用一个 `int` 类型的数组记录所有结点的入度。
- 将图上所有入度为 $0$ 的结点加入队列。

### 核心流程

1. 取出队头元素 $p$。
2. 遍历 $p$ 的所有**出边**，将**出边**所指向的结点的**入度**减 $1$，然后，如果所指结点的入度变为 $0$，则将其加入队列。
3. 重复执行上述两步，直到队列为空，此时之前取出队头元素的顺序就是拓扑排序的顺序。

## 应用

拓扑排序有许多应用，如可以判断一张图中的环，或提供一个 dp 的序列，等等。

这里介绍一下如何使用拓扑排序判环。

### 初始化

- 与求拓扑排序相同，在初始化时记录所有点的入度。
- 然后将所有入度为 $0$ 的结点入队。
- 如果图为无向图，则改为将所有入度 $\leqslant 1$ 的结点入队。

### 核心流程

1. 取出队头元素 $p$。
2. 遍历 $p$ 的所有**出边**，将**出边**所指向的结点的**入度**减 $1$，然后，如果所指结点的入度变为 $0$，则将其加入队列（如果图为无向图，则改为如结点的入度 $\leqslant 1$）。
3. 重复执行上述两步，直到队列为空。判断已经访问的结点数是否等于 $n$。等于 $n$ 说明全部结点都被访问过，无环；反之，则有环，且环由所有未入队的结点构成。